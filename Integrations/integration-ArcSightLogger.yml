commonfields:
  id: ArcSight Logger
  version: -1
name: ArcSight Logger
display: ArcSight Logger
category: SIEM & Analytics
image: data:image/png;base64,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
description: ArcSight events logger
detaileddescription: "To use the integration, start a search session using as-search
  command, both session id and search session id will be returned from the command.
  \nUse these arguments to preform further filter on the search (e.g. as-drilldown)
  or to request desired data (e.g. as-events). Eventually use as-close to close the
  search session and clean data from the server.  \n\nDate/time format for as-search
  command\nUse the following compliant date/time format in as-search parameters: \nyyyy-MM-dd'T'HH:mm:ss.SSSXXX\nFor
  example, May 26 2014 at 21:49:46 PM could have a format like one of the following:\nFormat
  in PDT: 2014-05-26T21:49:46.000-07:00\nFormat in UTC: 2014-05-26T21:49:46.000Z"
configuration:
- display: Server URL (e.g. https://192.168.0.1)*
  name: url
  defaultvalue: ""
  type: 0
  required: true
- display: Port
  name: port
  defaultvalue: "9000"
  type: 0
  required: true
- display: Fetch incidents
  name: isFetch
  defaultvalue: ""
  type: 8
  required: false
- display: Incident type
  name: incidentType
  defaultvalue: ""
  type: 13
  required: false
- display: Events query
  name: eventsQuery
  defaultvalue: ""
  type: 0
  required: false
- display: Do not validate server certificate
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: ""
  type: 8
  required: false
- display: Credentials
  name: credentials
  defaultvalue: ""
  type: 9
  required: false
script:
  script: |-
    function ArcSightLogger() {

        var addresses = {
            loginPath: 'core-service/rest/LoginService/login',
            logoutPath: 'core-service/rest/LoginService/logout',
            search: 'server/search',
            statusPath: 'server/search/status',
            drilldownPath: 'server/search/drilldown',
            eventsPath: 'server/search/events',
            closePath: 'server/search/close',
            stopPath: 'server/search/stop'
        };

        var httpMethods = {
            POST: 'POST',
            GET: 'GET'
        };
        //The Search Session Id. Required for all commands.
        var sessID;
        //The User Session Id returned from the login request. Required for all commands.
        var token;
        function setStandartRequestBody() {
            var body = {};
            body['search_session_id'] = sessID;
            body['user_session_id'] = token;
            return body;
        }
        var buildStandartRequestBody = function(){
            var body = setStandartRequestBody();
            return JSON.stringify(body);
        };
        var commands = {
            'as-search' : {
                path: addresses.search,
                method: httpMethods.POST,
                buildRequstBody: function() {
                    var body = setStandartRequestBody();
                    for (var key in args) {
                        args[key] = (key == 'timeout') ? parseInt(args[key]) : args[key];
                        body[key] = args[key];
                    }
                    return JSON.stringify(body);
                },
                customEntry: function(result) {
                    var entry = {
                        Type: entryTypes.note,
                        Contents: {
                            searchSessionId: sessID,
                            sessionId : token
                        },
                        ContentsFormat: formats.json,
                        ReadableContentsFormat: formats.markdown
                    };
                    var title = "ArcSight Logger - Start Search Session";
                    var context = {
                        'SearchSessionId': sessID,
                        'SessionId' : token
                    };
                    entry.HumanReadable = tableToMarkdown(title, context);
                    entry.EntryContext = {
                        ArcSightLogger: {
                            Search: context
                        }
                    };
                    return entry;
                }
            },
            'as-status' : {
                method: 'POST',
                path: addresses.statusPath,
                buildRequstBody: buildStandartRequestBody,
                translator: {
                    data: [
                        {to: 'Status', from: 'status'},
                        {to: 'ResultType', from: 'result_type'},
                        {to: 'Hit', from: 'hit'},
                        {to: 'Scanned', from: 'scanned'},
                        {to: 'Elapsed', from: 'elapsed'},
                        {to: 'Message', from: 'message'}
                    ],
                    title: 'ArcSight Logger - Search Status',
                }
            },
            'as-drilldown' : {
                path: addresses.drilldownPath,
                method: httpMethods.POST,
                buildRequstBody: function() {
                    var body = setStandartRequestBody();
                    for (var key in args) {
                        body[key] = args[key];
                    }
                    return JSON.stringify(body);
                },
                customEntry: function(result) {
                    var entry = {
                        Type: entryTypes.note,
                        Contents: result,
                        ContentsFormat: formats.json,
                        ReadableContentsFormat: formats.text
                    };
                    entry.HumanReadable = 'Success drilldown request';
                    return entry;
                }
            },
            'as-events' : {
                method: 'POST',
                path: addresses.eventsPath,
                buildRequstBody: function() {
                    var body = setStandartRequestBody();
                    for (var key in args) {
                        args[key] = (key == 'offset' || key == 'length') ? parseInt(args[key]) : args[key];
                        body[key] = args[key];
                    }
                    return JSON.stringify(body);
                },
                customEntry: function(result) {
                    var entry = {
                        Type: entryTypes.note,
                        Contents: result,
                        ContentsFormat: formats.json,
                        ReadableContentsFormat: formats.markdown
                    };
                    var title = 'ArcSight Logger - Events';
                    var context = eventsToContext(result);
                    entry.HumanReadable = eventsToMarkdown(result, title);
                    entry.EntryContext = {
                        ArcSight: {
                            Events: context
                        }
                    };
                    return entry;
                }
            },
            'as-close' : {
                path: addresses.closePath,
                method: httpMethods.POST,
                buildRequstBody: buildStandartRequestBody,
                customEntry: function(result) {
                    var entry = {
                        Type: entryTypes.note,
                        Contents: result,
                        ContentsFormat: formats.json,
                        ReadableContentsFormat: formats.text
                    };
                    entry.HumanReadable = 'Success close request';
                    return entry;
                }
            },
            'as-stop' : {
                path: addresses.stopPath,
                method: httpMethods.POST,
                buildRequstBody: buildStandartRequestBody,
                customEntry: function(result) {
                    var entry = {
                        Type: entryTypes.note,
                        Contents: result,
                        ContentsFormat: formats.json,
                        ReadableContentsFormat: formats.text
                    };
                    entry.HumanReadable = 'Success stop request';
                    return entry;
                }
            },
        };
        function eventsToContext(eventsRes) {
            var context = [];
            if (eventsRes && eventsRes.fields && eventsRes.results) {
                var keys = [];
                var fields = eventsRes.fields;
                var entries = eventsRes.results;
                fields.forEach(function(field){
                    if(field.name){
                        keys.push(field.name.replace(/\s/g, '').replace(/^\_/,''));
                    }
                });
                entries.forEach(function(entry){
                    if (entry.length == keys.length){
                        var newEntry = {};
                        for (var i = 0; i<  entry.length; i++){
                            var val = entry[i];
                            if(val !== '' && val !== undefined && val !== null ){
                                newEntry[keys[i]] = val;
                            }
                        }
                        context.push(newEntry);
                    }
                });
            }
            return context;

        }
        function eventsToMarkdown(eventsRes, title, headerTransform) {
            var mdResults = '';
            if (title) {
              mdResults = '### ' + title + '\n';
            }
            if (eventsRes && eventsRes.fields && eventsRes.results) {
                var headers = [];
                var fields = eventsRes.fields;
                if(!headerTransform){
                    headerTransform = function(string){return string.replace(/^\_/,'');};
                }
                fields.forEach(function(field){
                    if (field.name){
                        headers.push(headerTransform(field.name));
                    }
                });
                if (headers.length > 1) {
                  mdResults += headers.join('|') + '\n';
                } else {
                  mdResults += headers[0] + '|' + '\n';
                }
                var sep = [];
                headers.forEach(function(h){
                  sep.push('-');
                });
                if (sep.length === 1) {
                  sep[0] = sep[0]+'|';
                }
                mdResults += sep.join('|') + '\n';
                var results = eventsRes.results;
                results.forEach(function(arr){
                    if(arr.length == headers.length){
                        var vals = [];
                        arr.forEach(function(val){
                            if(val === null || val === undefined || val ==='') {
                                vals.push(' ');
                            } else {
                                vals.push(stringEscapeMD(formatCell(val), true) || ' ');
                            }
                        });
                        if (vals.length === 1) {
                            vals[0] = vals[0]+'|';
                        }
                        mdResults += vals.join('|') + '\n';
                    }
                });
            } else{
                mdResults += 'No data returned\n';
            }
            return mdResults;
        }
        function logRequest(requestBody) {
            var bodyStr = encodeToURLQuery(requestBody);
            var req = {
                Method: httpMethods.POST,
                Body: bodyStr.substring(1),
                Headers: {'Content-Type': ['application/x-www-form-urlencoded']}
            };
            return req;
        }
        function parseXML(httpResponse) {
            var body = httpResponse.Body.replace(/&#x.*?;/g, "");
            var parsed = JSON.parse(x2j(body));
            return parsed;
        }
        function initClient() {
            params.url = params.url.replace(/\/$/, "");
            var client = {
                password: params.credentials.password,
                userName: params.credentials.identifier,
                proxy: params.proxy,
                insecure: params.insecure,
                host: params.url + ':' + params.port + '/'
            };
            var login = function() {
                var fullPath = client.host + addresses.loginPath;
                var bodyObj ={login: client.userName, password: client.password};
                var req =logRequest(bodyObj);
                var res = http(fullPath, req, client.insecure, client.proxy);
                if (res.StatusCode !== 200) {
                    throw "Login to ArcSight Logger has failed - unknown response " + res.StatusCode;
                }
                var body = parseXML(res);
                if (!body.loginResponse.return) {
                    throw 'Login to ArcSight Logger has failed - Session id is missing from response';
                }
                token = body.loginResponse.return;
            };
            var logout = function() {
                if (!token) {
                    throw 'Cant logout from ArcSight Logger. Seesion id is missing';
                }
                var fullPath = client.host + addresses.logoutPath;
                var bodyObj = {authToken: token};
                var req = logRequest(bodyObj);
                var res = http(fullPath, req, client.insecure, client.proxy);
                if (res.StatusCode !== 204) {
                    throw "Logout from ArcSight Logger has failed - unknown response " + res.StatusCode;
                }
            };
            var getToken = function() { return token; };
            return {
                settings: client,
                login: login,
                logout: logout
            };
        }

        var c = initClient();

        var test = function() {
            c.login();
            c.logout();
        };

        function errMessage(msg) {
            return {
                sucsses: false,
                message: msg
            };
        }
        function errEntry(msg) {
            var entry = {
                Type: entryTypes.note,
                Contents: msg,
                ContentsFormat: formats.json,
                ReadableContentsFormat: formats.text,
                HumanReadable: msg
            };
            return entry;
        }
        var execute = function(cmd) {
            var url = c.settings.host + cmd.path;
            var req = {
                Headers: {
                    'Content-Type' : ['application/json; charset=UTF-8'],
                    'Accept': ['appliction/json']
                },
                Body: cmd.buildRequstBody(),
                Method: cmd.method
            };

            var res = http(url, req, c.settings.insecure, c.settings.proxy);
            var body = {};

            //drilldown empty response
            if (res.Body == '' && res.StatusCode == 200) {
                return {success: true, body: body};
            }
            try {
                body = JSON.parse(res.Body);
            } catch (err) {
                return errMessage('Unexpected response from ArcSight Logger. Failed to parse response body');
            }
            if (res.StatusCode >= 300) {
                var errTbl = body.errors[0];
                if (errTbl.message) return errMessage(errTbl.message);
                return errMessage("Request to ArcSight Logger has failed - unknown response " + res.StatusCode);
            }
            return {success: true, body: body};
        };
        function generateSearchSessionId() {
            sessID = new Date().getTime();
        }
        function setSession() {
            if (args.sessionId) {
                token = args.sessionId;
                delete args.sessionId;
            }
            if (args.searchSessionId) {
                //check if number
                sessID = parseInt(args.searchSessionId);
                delete args.searchSessionId;
            }
        }
        var executeAndCreateEntry = function(cmdName) {
            var cmd = commands[cmdName];
            if (!cmd) {
                throw 'Unknown command';
            }
            var res = execute(cmd);
            if (!res.success) return errEntry(res.message);
            if (cmd.translator) {
                return createEntry(res.body,cmd.translator);
            }
            return cmd.customEntry(res.body);
        };
        var startSearchSession = function() {
            generateSearchSessionId();
            try{
                c.login();
            } catch (err) {
                return errEntry(err);
            }
            return executeAndCreateEntry('as-search');
        };
        var runCommandOnExistingSession = function(cmdName) {
            setSession();
            return executeAndCreateEntry(cmdName);
        };
        var closeSession= function() {
            var entry = runCommandOnExistingSession('as-close');
            try{
                c.logout();
            } catch(err) {}
            return entry;
        }
        var dayInMillis = 24*60*60*1000;
        var fetchEventsAsIncidents= function(){
            var n = new Date();
            var lastRun = getLastRun();
            var currRun = {endTime: n.toISOString()};
            delete args['lastRun'];
            args['end_time'] = currRun.endTime;
            if (lastRun && lastRun.endTime && lastRun.endTime !== '') {
                args['start_time'] = lastRun.endTime;
            } else {
                n.setTime(n.getTime() - 200 * dayInMillis);
                args['start_time'] = n.toISOString();
            }
            if (params.eventsQuery){
                args['query'] = params.eventsQuery;
            }
            logInfo(JSON.stringify(args));
            startSearchSession();
            wait(5);
            var res = execute(commands['as-events']);
            var incidents = [];
            if (res.success && res.body !== '' && Object.keys(res.body).length > 0 ) {
                var events = eventsToContext(res.body);
                events.forEach(function(event){
                    var incident = incidentFromEvent(event);
                    //console.log(JSON.stringify(incident));
                    incidents.push(incident);
                });
            }
            setLastRun(currRun);
            closeSession();
            return JSON.stringify(incidents);
        };
        function incidentFromEvent(event){
            var incident = {}
            //incident.labels = Object.keys(event);
            incident.rawJSON = JSON.stringify(event);
            var name = 'ArcSight Logger Incident';
            name = event.rowId ? name + ' ' + event.rowId : name;
            incident.name = name;
            return incident;
        }
        return {
            test: test,
            run: runCommandOnExistingSession,
            startSearchSession: startSearchSession,
            closeSession: closeSession,
            fetchIncidents: fetchEventsAsIncidents
        };
    }
    var AS = ArcSightLogger();

    switch(command) {
        case 'test-module':
            AS.test();
            return 'ok';
        case 'as-search':
            return AS.startSearchSession();
        case 'as-close':
            return AS.closeSession();
        case 'fetch-incidents':
            return AS.fetchIncidents();
        default:
            return AS.run(command);
    }
  type: javascript
  commands:
  - name: as-search
    arguments:
    - name: discover_fields
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Indicates that the search should try to discover fields in the
        events found.
    - name: end_time
      description: The date and time string for the end time in the search time range.
        If end_ time is provided, start_time must be present as well. See Integration
        tips for correct date/time format.
    - name: start_time
      description: The date and time string for the start time in the search time
        range. If start_ time is provided, end_time must be present as well. See Integration
        tips for correct date/time format.
    - name: summary_fields
      description: Comma separated list of fields. To be used to calculate summary
        when field_summary is true.
    - name: field_summary
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Indicates to use the field summary.
    - name: local_search
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Indicates the search is local only, and does not include peers.
    - name: query
      description: The search query string to filter/process the events.
    - name: timeout
      description: The number of milliseconds to keep the search after processing
        has stopped. Default timeout is 10 minutes.
      defaultValue: "600000"
    - name: lastDays
      description: 'The number of days from from current time . Use to limit the search
        time range. '
    outputs:
    - contextPath: ArcSightLogger.Search.SearchSessionId
      description: The search session id
    - contextPath: ArcSightLogger.Search.SessionId
      description: The session id
    description: Start a new search
  - name: as-status
    arguments:
    - name: searchSessionId
      required: true
      description: The Search Session ID returned from as-search command
    - name: sessionId
      required: true
      description: The Session ID returned from as-search command
    outputs:
    - contextPath: ArcSightLogger.Status.Status
      description: The search status. Can be any of starting, running, complete, or
        error. If the specified search has not started yet, the status will be “starting".
    - contextPath: ArcSightLogger.Status.ResultType
      description: Indicates the type of the search results
    - contextPath: ArcSightLogger.Status.Hit
      description: The number of events found
    - contextPath: ArcSightLogger.Status.Scanned
      description: The number of events scanned.
    - contextPath: ArcSightLogger.Status.Elapsed
      description: The elapsed time of this search
    - contextPath: ArcSightLogger.Status.Message
      description: The message for the search. This will be used when there is an
        error in the local/peer search.
    description: Returns the latest status of the specified search.
  - name: as-drilldown
    arguments:
    - name: searchSessionId
      required: true
      description: The Search Session ID returned from as-search command
    - name: sessionId
      required: true
      description: The Session ID returned from as-search command
    - name: start_time
      description: The date and time string for the start time in the search time
        range. If start_ time is provided, end_time needs to be present as well. See
        Integration tips for correct date/time format.
    - name: end_time
      description: The date and time string for the end time in the search time range.
        If end_ time is provided, start_time needs to be present as well. See Integration
        tips for correct date/time format.
    - name: lastDays
      description: 'The number of days from from current time . Use to limit the search
        time range. '
    description: Narrows-down the search results to the specified time range
  - name: as-events
    arguments:
    - name: searchSessionId
      required: true
      description: The Search Session ID returned from as-search command
    - name: sessionId
      required: true
      description: The Session ID returned from as-search command
    - name: dir
      description: The sort direction based on event time. forward/backward (default
        is forward).
    - name: fields
      description: The list of fields in the order to show. If not specified, all
        fields will be used
    - name: length
      description: The length or number of events to retrieve. Maximum number is 10000.
    - name: offset
      description: The offset from the first even
    description: Returns the list of events found in the specified search.
  - name: as-close
    arguments:
    - name: sessionId
      required: true
      description: The Session ID returned from as-search command
    - name: searchSessionId
      required: true
      description: The Search Session ID returned from as-search command
    description: Stops the execution of the search and clears the search session data
      from the server.
  - name: as-stop
    arguments:
    - name: sessionId
      required: true
      description: The Session ID returned from as-search command
    - name: searchSessionId
      required: true
      description: The Search Session ID returned from as-search command
    description: Stops the search operation but keeps the search session so that the
      search results can be narrowed down later
  isfetch: true
