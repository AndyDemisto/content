commonfields:
id: Proofpoint Threat Response
version: -1
name: Proofpoint Threat Response
display: Proofpoint Threat Response
category: Threat Intelligence
image: data:image/png;base64,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
description: Provides the API for Proofpoint Threat Response. Threat Response is designed
to work in any IT Security and Security Operations Center environments - small,
medium, or large.
configuration:
- display: The API server address
name: Server
defaultvalue: ""
type: 0
required: true
- display: API Key
name: APIKey
defaultvalue: ""
type: 0
required: true
- display: Ignore certificate
name: insecure
defaultvalue: "false"
type: 8
required: false
script:
script: |-
  function fixUrl(url) {
      if (url.endsWith('/')) {
          return url.slice(0, -1);
      }

      return url;
  }
  var SERVER_URL = fixUrl(params.url) + '/';
  var INCIDENT_DEFAULT_COLUMNS = null;

  function sendRequest(path, queryParams){
      var requestUrl = SERVER_URL.concat(path, queryParams ? encodeToURLQuery(queryParams ) : '');

      var res = http(
          requestUrl,
          {

              Method: 'GET',
              Headers: {
                  Accept: ['application/json'],
                  Authorization: [params.APIKey]
              }
          },
          params.insecure
      );

      if (res.StatusCode < 200 || res.StatusCode >= 300) {
          throw 'Request Failed.\nStatus code: ' + res.StatusCode + '.\nBody: ' + JSON.stringify(res) + '.';
      }

      return res;
  };

  function getIncidentById(){
      var incident = getIncidentByIdRequest(args.incidentId);

      var entryContext = {
          Incident: incident
      };

      columnsList = INCIDENT_DEFAULT_COLUMNS;
      columnsList.sort();
      var md = 'Incident ' + args.incidentId + '\n';
      md += tblToMd('Incident details', result, columnsList);

      return {
          Type: entryTypes.note,
          Contents: result,
          ContentsFormat: formats.json,
          HumanReadable: md,
          EntryContext: entryContext
      };
  }

  function getIncidentByIdRequest(incidentId){
      var incident;
      var path = 'incidents';
      path.concat('/', incidentId, '.json');
      incident = sendRequest(path);

      return incident;
  }

  function getIncidents(){
      var results = retrieveIncidents(args);

      var entryContext = {
          Incident: results
      };

      columnsList = INCIDENT_DEFAULT_COLUMNS;
      columnsList.sort();
      var md = 'Incidents retrieved';
      md += tblToMd('Incident details', result, columnsList);

      return {
          Type: entryTypes.note,
          Contents: results,
          ContentsFormat: formats.json,
          HumanReadable: md,
          EntryContext: entryContext
      };
  }

  function getIncidentsRequest(queryParams){
      var result;
      result = sendRequest('incidents', queryParams);

      return result;
  }

  // The command input arg holds the command sent from the user.
  var result;
  switch (command) {
      // This is the call made when pressing the integration test button.
      case 'test-module':
          result = getIncidentsRequest();
          return result instanceof Array ? 'ok' : 'notok';
      case 'fetch-incidents':
      case 'proofpoint-get-incident-by-id':
          result = getIncidentById();
          return result;
      case 'proofpoint-get-incidents':
          result = getIncidents();
          return result;
      default:
  }
type: javascript
commands:
- name: proofpoint-get-incidents
  arguments:
  - name: state
    auto: PREDEFINED
    predefined:
    - new
    - open
    - assigned
    - closed
    - ignored
    description: State of the incidents to retrive
  - name: created_after
    description: Retrieve incidents that were created after specified date, in ISO
      8601 format (UTC)
  - name: created_before
    description: Retrieve incidents that were created before specified date, in
      ISO 8601 format (UTC)
  - name: closed_after
    description: Retrieve incidents that were closed after specified date, in ISO
      8601 format (UTC)
  description: Retrieve incidents metadata from Threat Response, by optionally specifying
    filter criteria such as the state of the incident or time of closure.
- name: proofpoint-get-incident-by-id
  arguments:
  - name: incidentId
    required: true
    description: The Id of the requested incident
hidden: false
releaseNotes: "-"
