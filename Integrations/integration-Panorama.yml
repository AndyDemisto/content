versionedfields: {}
commonfields:
  id: Panorama
  version: -1
name: Panorama
display: Panorama
category: Network Security
image: data:image/png;base64,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
detaileddescription: |-
  The integration uses the Panorama XML API.
  To obtain an API Key, use the following REST command:
  https://[PanoramaIP]/api/?type=keygen&user=[user]&password=[password]
  and copy the resulting key.
  For more information, visit: https://www.paloaltonetworks.com/documentation
configuration:
- display: Server URL (e.g. https://192.168.0.1)
  name: server
  defaultvalue: ""
  type: 0
  required: true
- display: API Key
  name: key
  defaultvalue: ""
  type: 4
  required: true
- display: Port
  name: port
  defaultvalue: ""
  type: 0
  required: false
- display: Do not validate server certificate (insecure)
  name: insecure
  defaultvalue: ""
  type: 8
  required: false
- display: Use system proxy settings
  name: proxy
  defaultvalue: ""
  type: 8
  required: false
script:
  script: |-
    var sendRequest = function(url) {
        url.replace(/[\/]+$/, '');
        var res = http(
            url,
            {
                Method: 'POST',
                Headers: {'Content-Type': ['application/x-www-form-urlencoded']},
            },
            params.insecure,
            params.proxy
        );

        if (res.StatusCode < 200 || res.StatusCode >= 300) {
            throw 'Request Failed.\nStatus code: ' + res.StatusCode + '.\nBody: ' + JSON.stringify(res) + '.';
        }

        return x2j(res.Body);
    };

    var sendMultipartRequest = function(url, file, apikey){
            var res = httpMultipart(
              url,
              file,
              {
                Method: 'POST',
              },
              {
                'key': apikey,
                'file' : file
              },
              params.insecure,
              params.proxy
            );

            if (res.StatusCode !==200) {
              throw 'Request Failed.\nStatus code: ' + res.StatusCode +' '+errorDict[res.StatusCode]+ '.\nBody: ' + JSON.stringify(res) + '.';
            }
            return JSON.parse(x2j(res.Body));
        };

    var url = params.server.replace(/[\/]+$/, '') + ':'+params.port+'/api/';

    switch (command) {
        case 'test-module':
            res = sendRequest(url + encodeToURLQuery({type:'config', action: 'show', key: params.key}));
            if(JSON.parse(res).response['-code'] < 200 || JSON.parse(res).response['-code'] >= 300){
                return res;
            }
            return 'ok';
        case 'panorama-dynamic-block-list':
            return sendMultipartRequest(url+encodeToURLQuery({'type':'user-id'}), args.file, params.key);
        case 'panorama':
            res = sendRequest(url+encodeToURLQuery(args)+'&key='+params.key);
            return JSON.parse(res);
    }
  type: javascript
  commands:
  - name: panorama
    arguments:
    - name: action
      description: Choose an available  actio(show,get,set,edit, delete,rename,clone,move,override)
    - name: category
      description: Category parameter. e.g. when exporting a configuration file use category=configuration
    - name: cmd
      description: Used for operations commands cmd specifies the xml struct that defines the command.
    - name: command
      description: Run a command. e.g. command =<show><arp><entry name='all'/></arp></show>
    - name: dst
      description: Specifies destination
    - name: element
      description: Used to define a new value for an object
    - name: to
      description: To parameter (used in specifying time and when cloning an object)
    - name: from
      description: From parameter (used in specifying time and when cloning an object)
    - name: key
      description: Sets a key value
    - name: log-type
      description: Used for retrieving logs. e.g. log-type=threat for threat logs
    - name: where
      description: Specifies the type of a move operation (e.g. where=after, where=before, where=top, where=bottom)
    - name: period
      description: Describe a time period. E.g. period=last-24-hrs
    - name: xpath
      description: Defines a location e.g. xpath=/config/predefined/application/entry[@name='hotmail']
    - name: pcap-id
      description: The threat pcap ID in the threat log
    - name: serialno
      description: Specifies the device serial number
    - name: reporttype
      description: Choose dynamic,predefined or custom report
    - name: reportname
      description: The report name
    - name: log-type
      descrition: Used for retrieving logs. e.g. log-type=threat for threat logs
    - name: type
      descrition: The request type (e.g. export, import, log, config)
    - name: search-time
      description: Used for threat PCAPs, the time that the PCAP was received on the firewall.
  - name: panorama-dynamic-block-list
    arguments:
    - name: file
      required: true
      description: The dynamic block list file. Can be created using PanoramaDynamicAddressGroup script
hidden: false