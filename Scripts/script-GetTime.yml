commonfields:
  id: GetTime
  version: -1
name: GetTime
script: |-
  var d = new Date();
  if ((args.date) && (args.date.length > 0)){
      d =  new Date(args.date);
  }
  prefix = '';
  if (args.contextKey) {
      prefix = args.contextKey
  }
  var timeStr = String(d);
  if ((args.dateFormat) && (args.dateFormat.length > 0)){
      switch(args.dateFormat) {
          case 'ISO':
              timeStr = d.toISOString();
              break;
          case 'GMT':
              timeStr = d.toGMTString();
              break;
          case 'UTC':
              timeStr = d.toUTCString();
              break;
          case 'Locale':
              timeStr = d.toLocaleString();
              break;
          case 'Date':
              timeStr = d.toDateString();
              break;
          default:
              throw 'Unsupported date format: '+args.dateFormat
      }
  }
  setContext(prefix+'TimeNowUnix',d.getTime());
  setContext(prefix+'TimeNow', timeStr);
  return timeStr;
type: javascript
tags:
- Utility
comment: |
  Retrieves the current date and time.
enabled: true
args:
- name: date
  default: true
  description: The date to use in the object
- name: dateFormat
  description: The date format for the result, can be ISO/GMT/UTC/Locale/Date
- name: contextKey
  default: false
  description: prefix the keys in the context for the results
outputs:
- contextPath: TimeNowUnix
  description: number of milliseconds since 1970/01/01
- contextPath: TimeNow
  description: current time in ISO format
scripttarget: 0
