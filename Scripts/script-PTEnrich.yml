commonfields:
  id: PTEnrich
  version: -1
name: PTEnrich
script: |
  var res = [];
  var commands = ['pt-get-subdomains', 'pt-passive-dns', 'pt-whois', 'pt-ssl-cert', 'pt-enrichment', 'pt-malware', 'pt-osint'];
  for (var i in commands) {
      var r = executeCommand(commands[i], {query: args.query});
      if (isError(r[0])) {
          return r[0];
      }
      res.push(r[0]);
  }
  return res;
type: javascript
tags:
- passive-total
- server
- threat-intel
comment: Enrich the given IP or domain with metadata, malware, osint
system: true
args:
- name: query
  required: true
  default: true
  description: The IP or domain to enrich
outputs:
- contextpath: passivetotal.username
  description: Username / Key used for PassiveTotal
- contextpath: passivetotal.whois.email
  description: Contact email for the queried domain
- contextpath: passivetotal.resolves
  description: The various resolves from the passive DNS collection
- contextpath: badIPs
  description: Bad IPs found during enrichment
  important: true
  importantDescription: Bad IPs found during enrichment
- contextpath: badDomains
  description: Bad domains found during enrichment
  important: true
  importantDescription: Bad domains found during enrichment
- contextPath: badHashes
  description: Bad hashes found on the queried entity
  important: true
  importantDescription: Bad hashes found on the queried entity
scripttarget: 0
dependson:
  must:
  - pt-enrichment
  - pt-malware
  - pt-osint
  - pt-get-subdomains
  - pt-passive-dns
  - pt-whois
  - pt-ssl-cert
timeout: 0s
