commonfields:
  id: ContextGetHashes
  version: -1
name: ContextGetHashes
script: |+
  var hash = args.hash;
  var flat = {};
  var res = [];

  flattenFields(invContext,undefined,flat);
  keysArr = Object.keys(flat);
  for (i = 0; i < keysArr.length; i++) {
      if ((/[a-fA-F0-9]/).test(flat[keysArr[i]]) && res.indexOf(flat[keysArr[i]]) == -1) {
          switch(hash) {
          case 'MD5':
              if (flat[keysArr[i]].length === 32)
                  res.push(flat[keysArr[i]]);
              break;
          case 'SHA1':
              if (flat[keysArr[i]].length === 40)
                  res.push(flat[keysArr[i]]);
              break;
          case 'SHA256':
              if (flat[keysArr[i]].length === 64)
                  res.push(flat[keysArr[i]]);
              break;
          case 'all':
              if ([32,40,64].indexOf(flat[keysArr[i]].length) > -1)
                  res.push(flat[keysArr[i]]);
              break;
          default:
          }
      }
  }
  var md = '### Hashes (' + hash + ') in context\n';
  for (var i = 0; i<res.length; i++) {
      md += '- ' + res[i] + '\n';
  }
  return {
          Type: entryTypes.note,
          Contents: res,
          ContentsFormat: formats.json,
          HumanReadable: md
          };

type: javascript
tags: []
comment: Gets hashes (MD5,SHA1,SHA256) from context.
enabled: true
args:
- name: hash
  auto: PREDEFINED
  predefined:
  - MD5
  - SHA1
  - SHA256
  - all
  description: Type of hash to get (MD5,SHA1,SHA256,all)
  defaultValue: all
scripttarget: 0
