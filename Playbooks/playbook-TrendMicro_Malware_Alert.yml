id: TrendMicro Malware Alert
version: -1
name: TrendMicro Malware Alert
description: |-
  Handles a TrendMicro Malware Alert (After Alet has been classified)
  This incident was created from the classifier playbook
tasks:
- id: "1"
  taskid: c75113e6-fdd2-45c6-8ea8-3bb7eef0cd68
  type: title
  task:
    id: c75113e6-fdd2-45c6-8ea8-3bb7eef0cd68
    version: 2
    name: The incident was generated from the classifier playbook
    type: section
- id: "2"
  taskid: a31ae220-98fa-4d86-835d-ea3b6340a75f
  type: regular
  task:
    id: a31ae220-98fa-4d86-835d-ea3b6340a75f
    version: 1
    name: Incident To Context
    script: IncidentToContext
    type: standard
  results:
  - Label/Application
  - Label/Database
  - Label/Directory
  - Label/Email
  - Label/Email/cc
  - Label/Email/from
  - Label/Email/format
  - Label/Email/html
  - Label/Email/text
  - Label/Email/subject
  - Label/Email/attachments
  - Label/Email/headers
  - Label/IP
  - Label/System
  - Label/URL
  - Label/User
  - Label/Brand
  - Label/Instance
  - id
  - created
  - modified
  - occurred
  - dueDate
  - name
  - owner
  - type
  - severity
  - phase
  - status
  - details
  - score
- id: "3"
  taskid: 298ceaf9-dc7a-42b8-8098-1dff19e59954
  type: title
  task:
    id: 298ceaf9-dc7a-42b8-8098-1dff19e59954
    version: 2
    name: Get host Anti-malware history
    type: section
- id: "4"
  taskid: e6a64a93-733d-40f6-8407-639879085a0d
  type: regular
  task:
    id: e6a64a93-733d-40f6-8407-639879085a0d
    version: 3
    name: Get host ID
    description: |-
      Returns the host ID

      The hostname is extracted from the context item: "Label/Classifier/Hostname"
      The hostID is saved to the context item: "Label/HostID"
    script: TrendMicroGetHostID
    type: standard
  scriptarguments:
    hostname: ${Label/Classifier/Hostname}
- id: "5"
  taskid: f27d7ba9-428d-4f4c-8e2a-87c2edcca7aa
  type: regular
  task:
    id: f27d7ba9-428d-4f4c-8e2a-87c2edcca7aa
    version: 2
    name: Trendmicro AntiMalware Event Retrieve
    description: Returns the Malware events from the past 7 days
    script: TrendmicroAntiMalwareEventRetrieve
    type: standard
  scriptarguments:
    eventFilterOperator: ""
    eventID: ""
    hostFilterType: SPECIFIC_HOST
    hostGroupID: ""
    hostID: ${Label/HostID}
    rangeFrom: ""
    rangeTo: ""
    securityProfileID: ""
    specificTime: ""
    timeFilterType: LAST_7_DAYS
- id: "6"
  taskid: d4b2f5fc-cf4b-4481-8ea0-39562a33bb3a
  type: title
  task:
    id: d4b2f5fc-cf4b-4481-8ea0-39562a33bb3a
    version: 1
    name: Isolate machine
    type: section
- id: "7"
  taskid: 3c5cfe20-5678-44a6-88db-e67a3f91aedd
  type: condition
  task:
    id: 3c5cfe20-5678-44a6-88db-e67a3f91aedd
    version: 1
    name: Isolate machine?
    description: Should the server activate a policy on the endpoint machine that
      will isolate it from the network?
    type: conditional
  condition:
    "no": []
    "yes":
    - id: "8"
      taskid: bfe95a74-e98d-492e-8a64-890c502e252c
      type: regular
      task:
        id: bfe95a74-e98d-492e-8a64-890c502e252c
        version: 1
        name: Get isolation policy's ID
        description: |-
          Retrieve the isolation policy's ID from server

          **Policy name should be added under the argument "policy"
        script: TrendMicroGetPolicyID
        type: standard
      scriptarguments:
        policy: add:ISOLATE_POLICY_NAME
    - id: "9"
      taskid: 222d4517-2865-4811-8a95-dc592841805f
      type: regular
      task:
        id: 222d4517-2865-4811-8a95-dc592841805f
        version: 1
        name: Assign Isolation policy to machine
        script: TrendmicroSecurityProfileAssignToHost
        type: standard
      scriptarguments:
        hostIDs: ${Label/HostID}
        securityProfileID: ${Label/PolicyID}
