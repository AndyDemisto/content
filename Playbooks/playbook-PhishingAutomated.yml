id: playbook5
version: -1
system: true
fromversion: 2.5.0
name: Phishing Playbook - Automated
description: |-
  This is an automated playbook to investigate suspected Phishing attempts.
  It picks up the required information from the incident metadata as created by the mail listener.
  Labels:
  - Email/from: Email address of the user targeted by the suspected phishing attempt, who reported the email by forwarding it
  - Email: the to recipients
  - Email/cc: the cc recipients
  - Email/format: the format of the email - text / html / etc.
  - Email/html: the html body
  - Email/text: the text body
  - Email/subject: subject of the email
  - Email/attachments: list of attachments
  - Email/headers: the headers for the email
tags:
- Phishing
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: ea4fb28a-8a76-4708-80c2-28f936d8bf94
    type: start
    task:
      id: ea4fb28a-8a76-4708-80c2-28f936d8bf94
      version: -1
      name: start_task
      type: start
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "1"
    view: |-
      {
        "position": {
          "x": 265,
          "y": 50
        }
      }
  "1":
    id: "1"
    taskid: ea731eb3-f592-42f3-892a-6a7d48c42e4d
    type: title
    task:
      id: ea731eb3-f592-42f3-892a-6a7d48c42e4d
      version: -1
      name: Triage and Engage
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "94"
      - "99"
    view: |-
      {
        "position": {
          "x": 265,
          "y": 195
        }
      }
  "4":
    id: "4"
    taskid: 2e0a1bd6-0e9a-4906-843c-e4652ed671f2
    type: regular
    task:
      id: 2e0a1bd6-0e9a-4906-843c-e4652ed671f2
      version: -1
      name: Auto-respond to acknowledge receipt
      description: Send an auto-response to the target telling them we are on it
      scriptName: SendEmail
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      attachIDs: ""
      bcc: ""
      body: "Hi ${Account=val.DisplayName || val.Email},\nWe've received your email
        and are investigating.\nPlease do not touch the email until further notice.\n\nCordially,
        \n  Your friendly neighborhood security team"
      cc: ""
      htmlBody: ""
      noteEntryID: ""
      subject: 'Re: Phishing Investigation - ${incident.name}'
      to: ${Account.Email}
    view: |-
      {
        "position": {
          "x": 50,
          "y": 690
        }
      }
  "13":
    id: "13"
    taskid: b2b1f385-7cff-427a-8882-2c18875c9a2e
    type: regular
    task:
      id: b2b1f385-7cff-427a-8882-2c18875c9a2e
      version: -1
      name: Extract IP Addresses from email
      scriptName: ExtractIP
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "14"
    scriptarguments:
      text: ${Email}
    view: |-
      {
        "position": {
          "x": 480,
          "y": 690
        }
      }
  "14":
    id: "14"
    taskid: a846334e-5ccc-4d95-8244-d57ec36d6e2f
    type: regular
    task:
      id: a846334e-5ccc-4d95-8244-d57ec36d6e2f
      version: -1
      name: Extract URLs from email
      scriptName: ExtractURL
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "72"
    scriptarguments:
      text: ${Email}
    view: |-
      {
        "position": {
          "x": 480,
          "y": 865
        }
      }
  "23":
    id: "23"
    taskid: c752c128-ee8f-4f94-877a-39bdb10a7d40
    type: condition
    task:
      id: c752c128-ee8f-4f94-877a-39bdb10a7d40
      version: -1
      name: Is the attachment malicious according to Sandbox report?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "28"
      "yes":
      - "42"
    scriptarguments:
      data: ${urls}
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 1710
        }
      }
  "28":
    id: "28"
    taskid: 4440a41f-7d53-4a52-86bb-85b49b6722b4
    type: title
    task:
      id: 4440a41f-7d53-4a52-86bb-85b49b6722b4
      version: -1
      name: 'Manual Investigation Step 1: Initial Inspection'
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "30"
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 1885
        }
      }
  "30":
    id: "30"
    taskid: 7f2d8700-472f-4cfa-87e4-97681e5309fa
    type: regular
    task:
      id: 7f2d8700-472f-4cfa-87e4-97681e5309fa
      version: -1
      name: Check sender domain distance
      description: Check if the sender is trying to confuse the user with a domain
        that is very close to one of our own email domains
      scriptName: CheckSenderDomainDistance
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "89"
    scriptarguments:
      distance: ""
      domain: ${inputs.CompanyDomains}
      sender: ${Acount.Email}
    results:
    - LevenshteinDistance
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 2030
        }
      }
  "31":
    id: "31"
    taskid: 5778ac35-8936-4170-8cf6-8cc09c98a300
    type: regular
    task:
      id: 5778ac35-8936-4170-8cf6-8cc09c98a300
      version: -1
      name: Manually inspect the email for anything suspicious
      description: Since automatic triage did not find anything wrong, please inspect
        it manually and see if something stands out
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "32"
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 2380
        }
      }
  "32":
    id: "32"
    taskid: 5445acdd-df36-403e-8635-a0cbc3bd3f04
    type: regular
    task:
      id: 5445acdd-df36-403e-8635-a0cbc3bd3f04
      version: -1
      name: Assign and involve appropriate personnel
      description: 'Invite the relevant users for investigation - malware expert and
        network experts if needed. '
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "33"
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 2555
        }
      }
  "33":
    id: "33"
    taskid: e76cfd73-35f3-4065-8e59-c37e365cd06c
    type: regular
    task:
      id: e76cfd73-35f3-4065-8e59-c37e365cd06c
      version: -1
      name: Assess severity
      description: 'Based on the end user affected, and other information assess and
        change the severity if needed. '
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "34"
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 2730
        }
      }
  "34":
    id: "34"
    taskid: 3e30e515-bb4e-4b65-8d8c-a21a1e380126
    type: title
    task:
      id: 3e30e515-bb4e-4b65-8d8c-a21a1e380126
      version: -1
      name: 'Manual Investigation Step 2: Deeper Inspection'
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "36"
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 2905
        }
      }
  "36":
    id: "36"
    taskid: cceb5cd4-a661-434d-87d8-24b9988877c4
    type: condition
    task:
      id: cceb5cd4-a661-434d-87d8-24b9988877c4
      version: -1
      name: Check if the hostname in urls is being misrepresented?
      description: |-
        See if the URL text versus the hostname shown are different by hovering
         over the link. Also carefully inspected the URL for spelling spoofing which
         is typically a sign of phishing email.
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "44"
      "yes":
      - "42"
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 3050
        }
      }
  "42":
    id: "42"
    taskid: 103b416e-75c9-4628-8b32-0dbab7b0f7a8
    type: title
    task:
      id: 103b416e-75c9-4628-8b32-0dbab7b0f7a8
      version: -1
      name: Response
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "46"
    scriptarguments:
      key: responseRequired
      value: "yes"
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3240
        }
      }
  "44":
    id: "44"
    taskid: aafb8c0f-765a-4bbb-81c9-b1435b795f2e
    type: regular
    task:
      id: aafb8c0f-765a-4bbb-81c9-b1435b795f2e
      version: -1
      name: Send email to user notifying them this email is safe
      scriptName: SendEmail
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "45"
    scriptarguments:
      attachIDs: ""
      bcc: ""
      body: |-
        Hi ${Account=val.DisplayName || val.Email},
        We've concluded that the email you forwarded to us is safe.
        Thank you for your alertness and your participation in keeping our organization secure.
        Cordially,
          Your security team
      cc: ""
      htmlBody: ""
      noteEntryID: ""
      subject: 'Re: Phishing Investigation - ${incident.name}'
      to: ${Account.Email}
    view: |-
      {
        "position": {
          "x": 1022.5,
          "y": 3225
        }
      }
  "45":
    id: "45"
    taskid: abf517ab-27b6-49a9-853d-41e56650a92a
    type: regular
    task:
      id: abf517ab-27b6-49a9-853d-41e56650a92a
      version: -1
      name: Close the phishing investigation
      scriptName: CloseInvestigation
      type: regular
      iscommand: false
      brand: ""
    scriptarguments:
      notes: Concluded that this email is safe and sent a response to user notifying
        them that they may proceed normally.
      reason: Safe
    view: |-
      {
        "position": {
          "x": 1022.5,
          "y": 3400
        }
      }
  "46":
    id: "46"
    taskid: 8a9ba010-09e1-4aa6-810f-859ae66768e6
    type: regular
    task:
      id: 8a9ba010-09e1-4aa6-810f-859ae66768e6
      version: -1
      name: Send email to user notifying them it's a malicious email
      scriptName: SendEmail
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "47"
    scriptarguments:
      attachIDs: ""
      bcc: ""
      body: |-
        Hi ${Account=val.DisplayName || val.Email},
        We've concluded that the email you forwarded to us is malicious. We've taken steps to blacklist the sender and quarantine the email. Good job on detecting and forwarding it to us!

        All the best,
          Your security team
      cc: ""
      htmlBody: ""
      noteEntryID: ""
      subject: 'Re: Phishing Investigation - ${incident.name}'
      to: ${Account.Email}
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3400
        }
      }
  "47":
    id: "47"
    taskid: 08c684e8-65b9-4461-8eea-64991f25efef
    type: condition
    task:
      id: 08c684e8-65b9-4461-8eea-64991f25efef
      version: -1
      name: 'Is Mimecast integration available '
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "48"
      "yes":
      - "49"
    scriptarguments:
      brandname: mimecast
    results:
    - brandInstances
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3575
        }
      }
  "48":
    id: "48"
    taskid: b97c18b9-ee11-4e6b-82cd-a730863ea41b
    type: regular
    task:
      id: b97c18b9-ee11-4e6b-82cd-a730863ea41b
      version: -1
      name: Get full list of all mailboxes from Exchange server
      scriptName: ADGetEmailForAllUsers
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "50"
    view: |-
      {
        "position": {
          "x": 265,
          "y": 3750
        }
      }
  "49":
    id: "49"
    taskid: 1bf51a66-fe54-4473-8909-db3137b1dfa5
    type: regular
    task:
      id: 1bf51a66-fe54-4473-8909-db3137b1dfa5
      version: -1
      name: Find all mailboxes containing the malicious email using Mimecast
      scriptName: MimecastFindEmail
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "50"
    scriptarguments:
      active: ""
      attachmentText: ""
      attachmentType: ${incident.labels.Email/attachments}
      body: ""
      date: ""
      dateFrom: ""
      dateTo: ""
      dryRun: ""
      pageSize: ""
      queryXml: ""
      sentFrom: ${incident.labels.Email/from}
      sentTo: ""
      startRow: ""
      subject: ${incident.labels.Email/subject}
      text: ""
    view: |-
      {
        "position": {
          "x": 695,
          "y": 3750
        }
      }
  "50":
    id: "50"
    taskid: 007b26a1-f6e0-43e4-8ec0-1b86d3016662
    type: regular
    task:
      id: 007b26a1-f6e0-43e4-8ec0-1b86d3016662
      version: -1
      name: Search all mailboxes to find instances of the email
      scriptName: ExchangeSearch
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "51"
    scriptarguments:
      attachmentName: ${incident.labels.Email/attachments}
      body: ""
      mailbox: ${Mailboxes}
      sender: ${Label/Email/from}
      subject: ${Label/Email/subject}
    results:
    - ExchangeItemIDs
    view: |-
      {
        "position": {
          "x": 480,
          "y": 3925
        }
      }
  "51":
    id: "51"
    taskid: 977c3554-a203-4b75-8341-3cfe787c2189
    type: condition
    task:
      id: 977c3554-a203-4b75-8341-3cfe787c2189
      version: -1
      name: Were any emails found on server?
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "55"
      "yes":
      - "52"
    scriptarguments:
      key: ${ExchangeItemIDs}
      value: ${ExchangeItemIDs}
    view: |-
      {
        "position": {
          "x": 480,
          "y": 4100
        }
      }
  "52":
    id: "52"
    taskid: 952c4981-c88c-475e-8ec3-5f4445256bb1
    type: condition
    task:
      id: 952c4981-c88c-475e-8ec3-5f4445256bb1
      version: -1
      name: Review found emails and decide whether to go ahead with automatic delete
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "53"
      "yes":
      - "54"
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 4275
        }
      }
  "53":
    id: "53"
    taskid: 370383b4-f933-48fe-8a51-ed24db1b81fe
    type: regular
    task:
      id: 370383b4-f933-48fe-8a51-ed24db1b81fe
      version: -1
      name: Delete the emails from mailboxes manually
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "55"
    view: |-
      {
        "position": {
          "x": 377.5,
          "y": 4450
        }
      }
  "54":
    id: "54"
    taskid: e58b34a6-42f7-48ae-8560-55c9ef407079
    type: regular
    task:
      id: e58b34a6-42f7-48ae-8560-55c9ef407079
      version: -1
      name: Delete the instances of the email from Exchange server
      description: "Deleting the infected mails' IDs, useing EWS\nMail IDs are saved
        in context in \"ExchangeItemIDs\" "
      scriptName: ExchangeDeleteIDsFromContext
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "55"
    scriptarguments:
      attachmentName: ""
      mailbox: ${Users}
      sender: ""
      subject: ${Label/Email/subject}
    results:
    - ExchangeItemIDs
    view: |-
      {
        "position": {
          "x": 807.5,
          "y": 4450
        }
      }
  "55":
    id: "55"
    taskid: 53f1e043-8102-45f0-8146-556e4ee7ebe0
    type: condition
    task:
      id: 53f1e043-8102-45f0-8146-556e4ee7ebe0
      version: -1
      name: Did we find an attachment inside the email and extract its hash?
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "91"
      "yes":
      - "56"
    scriptarguments:
      key: AttachmentMD5
      value: ${File.EntryID(val!=val1---EmailAttachment)}
    view: |-
      {
        "position": {
          "x": 480,
          "y": 4625
        }
      }
  "56":
    id: "56"
    taskid: 748ff23d-6431-46bf-81e5-769ce4e4ac7d
    type: condition
    task:
      id: 748ff23d-6431-46bf-81e5-769ce4e4ac7d
      version: -1
      name: Is Carbon Black Protection (Bit9) Available?
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "60"
      "yes":
      - "57"
    scriptarguments:
      brandname: carbonblackprotection
    results:
    - brandInstances
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 4800
        }
      }
  "57":
    id: "57"
    taskid: 7cc132b7-9bae-4a0f-87fe-0d4b2583fff9
    type: regular
    task:
      id: 7cc132b7-9bae-4a0f-87fe-0d4b2583fff9
      version: -1
      name: Search attachment hash in the Bit9 file catalog
      scriptName: CBPCatalogFindHash
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "58"
    scriptarguments:
      md5: ${File(val.EntryID != val1---EmailAttachment).MD5}
    view: |-
      {
        "position": {
          "x": 705,
          "y": 4975
        }
      }
  "58":
    id: "58"
    taskid: 9a075c4f-97c2-42e1-8fec-a039c5a95580
    type: regular
    task:
      id: 9a075c4f-97c2-42e1-8fec-a039c5a95580
      version: -1
      name: Check if the attachment hash is included in any Bit9 rules
      scriptName: CBPFindRule
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "59"
    scriptarguments:
      hash: ${File(val.EntryID != val1---EmailAttachment).MD5}
    view: |-
      {
        "position": {
          "x": 705,
          "y": 5150
        }
      }
  "59":
    id: "59"
    taskid: fde5176a-66b8-4fb8-8147-f04d174e9c66
    type: regular
    task:
      id: fde5176a-66b8-4fb8-8147-f04d174e9c66
      version: -1
      name: Review Bit9 results
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "60"
    view: |-
      {
        "position": {
          "x": 705,
          "y": 5325
        }
      }
  "60":
    id: "60"
    taskid: 6a229223-43ef-4e76-8a7e-2b6003f5bbf0
    type: condition
    task:
      id: 6a229223-43ef-4e76-8a7e-2b6003f5bbf0
      version: -1
      name: Is Carbon Black Response available?
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "64"
      "yes":
      - "61"
    scriptarguments:
      brandname: carbonblack
    results:
    - brandInstances
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 5500
        }
      }
  "61":
    id: "61"
    taskid: 8224c836-3b29-4630-8b55-e0ff119ae2e3
    type: regular
    task:
      id: 8224c836-3b29-4630-8b55-e0ff119ae2e3
      version: -1
      name: Search attachments using Carbon Black
      scriptName: CBFindHash
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "62"
    scriptarguments:
      md5: ${File(val.EntryID != val1---EmailAttachment).MD5}
    results:
    - found_file_locations
    view: |-
      {
        "position": {
          "x": 705,
          "y": 5675
        }
      }
  "62":
    id: "62"
    taskid: ef23d7ba-07ce-4264-8f38-5b0c300a0a7a
    type: condition
    task:
      id: ef23d7ba-07ce-4264-8f38-5b0c300a0a7a
      version: -1
      name: Did Carbon Black find the attachment on any endpoints?
      description: If someone saved or executed the malicious attachment, we need
        to investigate further
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "64"
      "yes":
      - "63"
    scriptarguments:
      md5: ${AttachmentMD5}
      value: ${found_file_locations}
    view: |-
      {
        "position": {
          "x": 705,
          "y": 5850
        }
      }
  "63":
    id: "63"
    taskid: 7b2f5045-5c2e-4db3-895b-f3cd8d51ef20
    type: regular
    task:
      id: 7b2f5045-5c2e-4db3-895b-f3cd8d51ef20
      version: -1
      name: Investigate further
      description: Investigate the results of the execution
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "64"
    view: |-
      {
        "position": {
          "x": 817.5,
          "y": 6025
        }
      }
  "64":
    id: "64"
    taskid: 3aa9da87-5b96-4fd6-8c5a-89df2bd4de6c
    type: condition
    task:
      id: 3aa9da87-5b96-4fd6-8c5a-89df2bd4de6c
      version: -1
      name: Is CrowdStrike Falcon Host available?
      scriptName: IsIntegrationAvailable
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "91"
      "yes":
      - "65"
    scriptarguments:
      brandname: FalconHost
    results:
    - brandInstances
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 6200
        }
      }
  "65":
    id: "65"
    taskid: 4798ffd7-34a3-4fe3-83c3-12997f48570c
    type: regular
    task:
      id: 4798ffd7-34a3-4fe3-83c3-12997f48570c
      version: -1
      name: Search for the attachment using CrowdStrike
      script: FalconHost|||cs-device-ran-on
      type: regular
      iscommand: true
      brand: FalconHost
    nexttasks:
      '#none#':
      - "66"
    scriptarguments:
      type: md5
      value: ${File(val.EntryID != val1---EmailAttachment).MD5}
    view: |-
      {
        "position": {
          "x": 705,
          "y": 6375
        }
      }
  "66":
    id: "66"
    taskid: 7a76cb74-cf61-49e3-8862-ff4cb0292aec
    type: condition
    task:
      id: 7a76cb74-cf61-49e3-8862-ff4cb0292aec
      version: -1
      name: Did CrowdStrike locate the IOC on any devices?
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "91"
      "yes":
      - "67"
    scriptarguments:
      key: CSFoundDevices
      value: ${FalconHostDevices}
    view: |-
      {
        "position": {
          "x": 705,
          "y": 6550
        }
      }
  "67":
    id: "67"
    taskid: 7b2f5045-5c2e-4db3-895b-f3cd8d51ef20
    type: regular
    task:
      id: 7b2f5045-5c2e-4db3-895b-f3cd8d51ef20
      version: -1
      name: Investigate further
      description: Investigate the results of the execution
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "91"
    view: |-
      {
        "position": {
          "x": 817.5,
          "y": 6725
        }
      }
  "71":
    id: "71"
    taskid: 75e0739e-4f37-4859-8ae2-857be0d57d6c
    type: title
    task:
      id: 75e0739e-4f37-4859-8ae2-857be0d57d6c
      version: -1
      name: Extract indicators
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "13"
    view: |-
      {
        "position": {
          "x": 480,
          "y": 530
        }
      }
  "72":
    id: "72"
    taskid: 03606952-f504-44b2-8371-5a548e395048
    type: title
    task:
      id: 03606952-f504-44b2-8371-5a548e395048
      version: -1
      name: Check indicators
      type: title
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "97"
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1040
        }
      }
  "81":
    id: "81"
    taskid: 5359d876-c7b6-495c-8249-fd87d30d5663
    type: condition
    task:
      id: 5359d876-c7b6-495c-8249-fd87d30d5663
      version: -1
      name: Was any malicious indicator found?
      scriptName: IsMaliciousIndicatorFound
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "100"
      "yes":
      - "42"
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1360
        }
      }
  "89":
    id: "89"
    taskid: a2f77d09-4dc1-431a-8d7f-538f3b285e56
    type: condition
    task:
      id: a2f77d09-4dc1-431a-8d7f-538f3b285e56
      version: -1
      name: Is the distance really small
      scriptName: Exists
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      "no":
      - "31"
      "yes":
      - "42"
    scriptarguments:
      value: ${LevenshteinDistance(val > 0 && val < 3}
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 2205
        }
      }
  "91":
    id: "91"
    taskid: 2e785868-8ecb-47b8-8123-66e817a31f57
    type: regular
    task:
      id: 2e785868-8ecb-47b8-8123-66e817a31f57
      version: -1
      name: Review all results and decide should we close investigation
      type: regular
      iscommand: false
      brand: ""
    view: |-
      {
        "position": {
          "x": 480,
          "y": 6900
        }
      }
  "94":
    id: "94"
    taskid: bff69be5-924f-4eda-8264-83e9c2246ab6
    type: regular
    task:
      id: bff69be5-924f-4eda-8264-83e9c2246ab6
      version: -1
      name: Store the sending account
      scriptName: Set
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "98"
    scriptarguments:
      key: Account.Email
      value: ${incident.labels.Email/from}
    view: |-
      {
        "position": {
          "x": 50,
          "y": 340
        }
      }
  "97":
    id: "97"
    taskid: 286c067d-78e0-4d90-8107-eec5625b4b82
    type: playbook
    task:
      id: 286c067d-78e0-4d90-8107-eec5625b4b82
      version: -1
      name: ""
      playbookName: Enrichment Playbook
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "81"
    view: |-
      {
        "position": {
          "x": 480,
          "y": 1185
        }
      }
  "98":
    id: "98"
    taskid: 6104b475-bee7-42aa-87c4-07c6e433a350
    type: playbook
    task:
      id: 6104b475-bee7-42aa-87c4-07c6e433a350
      version: -1
      name: ""
      playbookName: Account Enrichment
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "4"
    view: |-
      {
        "position": {
          "x": 50,
          "y": 515
        }
      }
  "99":
    id: "99"
    taskid: abdcdddf-7b08-4c4a-8f29-842890ee1351
    type: playbook
    task:
      id: abdcdddf-7b08-4c4a-8f29-842890ee1351
      version: -1
      name: ""
      playbookName: Process Email
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "71"
    view: |-
      {
        "position": {
          "x": 480,
          "y": 340
        }
      }
  "100":
    id: "100"
    taskid: 27922299-5a0b-4525-8465-7c2efd9503b5
    type: playbook
    task:
      id: 27922299-5a0b-4525-8465-7c2efd9503b5
      version: -1
      name: ""
      playbookName: Detonate files
      type: playbook
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "23"
    view: |-
      {
        "position": {
          "x": 592.5,
          "y": 1535
        }
      }
view: |-
  {
    "linkLabelsPosition": {
      "23_28_#default#": 0.81,
      "23_42_yes": 0.1,
      "36_42_yes": 0.11,
      "51_52_yes": 0.73,
      "60_64_#default#": 0.85,
      "62_64_#default#": 0.46
    },
    "paper": {
      "dimensions": {
        "height": 6945,
        "width": 1352.5,
        "x": 50,
        "y": 50
      }
    }
  }
inputs:
- key: CompanyDomains
  value: company.com
  description: The domains for the company to try and match closeness of sender. Comma
    separated.
