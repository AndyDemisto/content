id: playbook17
fromversion: 3.5.0
system: true
version: -1
name: Carbon black Protection Rapid IOC Hunting
description: Hunt for endpoint activity involving hash IOCs, using Carbon Black Protection.
starttaskid: "0"
tasks:
  "0":
    id: "0"
    taskid: beabda04-030d-4f10-84f1-b1db9cf9e2b0
    type: start
    task:
      id: beabda04-030d-4f10-84f1-b1db9cf9e2b0
      version: -1
      name: start_task
      description: ""
      type: start
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "10"
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 275,
          "y": 50
        }
      }
  "8":
    id: "8"
    taskid: 4d7028b4-bd69-48b5-85d0-df111c25ecd9
    type: regular
    task:
      id: 4d7028b4-bd69-48b5-85d0-df111c25ecd9
      version: -1
      name: Search hashes in the file catalog
      description: Searching The file catalog for the hashes
      scriptName: CBPCatalogFindHash
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "9"
    scriptarguments:
      md5:
        complex:
          root: inputs
          accessor: Hash
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -197,
          "y": 572
        }
      }
  "9":
    id: "9"
    taskid: 14dcdb77-91ae-44a4-858b-d3fa88abe992
    type: regular
    task:
      id: 14dcdb77-91ae-44a4-858b-d3fa88abe992
      version: -1
      name: Check if the hashes are included in any rules
      description: If the hashes have been approved or blocked in the past, they will
        be in existing rules. It is useful to see whether the hash was in some blacklist
        or whitelist or a person marked them as such, possibly with a comment explaining
        their reasons.
      scriptName: CBPFindRule
      type: regular
      iscommand: false
      brand: ""
    nexttasks:
      '#none#':
      - "11"
    scriptarguments:
      hash:
        complex:
          root: inputs
          accessor: Hash
    separatecontext: false
    view: |-
      {
        "position": {
          "x": -197,
          "y": 745
        }
      }
  "10":
    id: "10"
    taskid: 4224a038-730f-4a9c-81b8-b9f0bc60394b
    type: condition
    task:
      id: 4224a038-730f-4a9c-81b8-b9f0bc60394b
      version: -1
      name: Is Carbon Black Protection enabled?
      description: Is Carbon Black Protection enabled?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "11"
      "yes":
      - "12"
    scriptarguments:
      value:
        simple: ${modules(val.brand == 'carbonblackprotection' && val.state == 'active')}
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: general.isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: string.isEqual
                    left:
                      value:
                        simple: modules.brand
                      iscontext: true
                    right:
                      value:
                        simple: carbonblackprotection
            iscontext: true
      - - operator: general.isExists
          left:
            value:
              complex:
                root: modules
                filters:
                - - operator: string.isEqual
                    left:
                      value:
                        simple: modules.state
                      iscontext: true
                    right:
                      value:
                        simple: active
            iscontext: true
    view: |-
      {
        "position": {
          "x": 275,
          "y": 195
        }
      }
  "11":
    id: "11"
    taskid: 93a2df6f-0ee2-4693-8a43-327297f25cb0
    type: title
    task:
      id: 93a2df6f-0ee2-4693-8a43-327297f25cb0
      version: -1
      name: Done
      description: Done
      type: title
      iscommand: false
      brand: ""
    separatecontext: false
    view: |-
      {
        "position": {
          "x": 244,
          "y": 927
        }
      }
  "12":
    id: "12"
    taskid: 2f76a11d-dc6b-4895-83e1-db0645837ac9
    type: condition
    task:
      id: 2f76a11d-dc6b-4895-83e1-db0645837ac9
      version: -1
      name: Do we have files to hunt?
      description: Do we have files to hunt?
      type: condition
      iscommand: false
      brand: ""
    nexttasks:
      '#default#':
      - "11"
      "yes":
      - "8"
    scriptarguments:
      value:
        simple: ${File.MD5}
    separatecontext: false
    conditions:
    - label: "yes"
      condition:
      - - operator: general.isExists
          left:
            value:
              complex:
                root: inputs
                accessor: Hash
            iscontext: true
    view: |-
      {
        "position": {
          "x": -50,
          "y": 380
        }
      }
view: |-
  {
    "linkLabelsPosition": {
      "10_11_#default#": 0.36,
      "12_11_#default#": 0.32
    },
    "paper": {
      "dimensions": {
        "height": 942,
        "width": 852,
        "x": -197,
        "y": 50
      }
    }
  }
inputs:
- key: Hash
  value:
    complex:
      root: File
      accessor: MD5
  required: false
  description: The MD5 Hash to hunt for
outputs:
- contextPath: found_hashes
  description: The existing hashes that were found
  type: string
releaseNotes: "-"