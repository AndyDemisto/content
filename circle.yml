test:
  pre:
    # install python client
    - pip install git+https://github.com/demisto/demisto-py.git@test-content

    # create content bundle
    - mkdir bundle
    - cd Tools/ && for i in */ ; do zip -jr "../bundle/tools-${i%/}.zip" "$i"; done
    - cp Integrations/* bundle/
    - cp Misc/* bundle/
    - cp Playbooks/* bundle/
    - cp Reports/* bundle/

    - if [ "$CIRCLE_BRANCH" != "master" ]; then cp TestPlaybooks/* bundle/ ; fi
    - cp $(find Scripts -type f -print) bundle/
    - cd bundle/ && zip ../content.zip *
    - cp content.zip $CIRCLE_ARTIFACTS/content.zip
  override:
    - chmod +x ./Tests/scripts/*

    # validate yaml
    - chmod +x ./Tests/yamlvalidator
    - ./Tests/yamlvalidator

    # ensure file name
    - ./Tests/scripts/ensurefilenames.sh

    # download conf file
    - ./Tests/scripts/download_conf_file.sh

    # configure installer commands
    - ./Tests/scripts/configure_installer_commands.sh

    # get installer from server
    - ./Tests/scripts/server_get_artifact.sh

    # run demisto instance
    - ./Tests/scripts/create_instance.sh

    # run installer
    - ./Tests/scripts/run_installer_on_instance.sh

    # wait for server to finish loading
    - ./Test/script/wait_until_server_ready.sh

    # run tests
    - ./Tests/scripts/run_tests.sh

    #- ./Test/script/sleep.sh

    # terminate instance
    - ./Tests/scripts/destroy_instances.sh
